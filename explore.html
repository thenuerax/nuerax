<!DOCTYPE html>
<html lang="en" class="bg-[#0F1115] text-[#F5F7FA] scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nuerax — Explore AI News</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.11.1/tsparticles.bundle.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }
    body {
      opacity: 0;
      background-color: #0F1115;
      background-image: radial-gradient(circle at 20% 20%, rgba(0, 255, 255, 0.05) 0%, transparent 70%),
                        radial-gradient(circle at 80% 40%, rgba(255, 0, 255, 0.05) 0%, transparent 70%);
      transition: opacity 0.5s ease-in-out;
    }
    body.fade-in {
      opacity: 1;
    }
    nav {
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .hidden-search {
      display: none;
    }
  </style>
</head>
<body class="font-sans leading-relaxed text-base antialiased">

  <!-- Particle Background -->
  <div id="tsparticles" class="fixed top-0 left-0 w-full h-full z-0 pointer-events-none"></div>

  <!-- Fixed Nav Bar -->
  <nav id="navbar" class="fixed top-0 left-0 w-full px-6 py-4 flex justify-between items-center z-50 bg-[#0F1115] bg-opacity-90 backdrop-blur-md border-b border-white/10 shadow-sm">
    <a href="index.html" class="transition-link text-2xl font-bold tracking-tight text-white">Nuerax</a>
    <div class="flex items-center space-x-4">
      <img id="searchToggle" src="https://i.imgur.com/J3IfkLV.png" alt="Search" class="w-6 h-6 cursor-pointer" />
      <button id="loginBtn" class="text-[#00FFFF] border border-[#00FFFF] px-4 py-1 rounded hover:bg-[#00FFFF] hover:text-black transition">
        Log In
      </button>
    </div>
  </nav>

  <!-- Search Dropdown -->
  <div id="searchDropdown" class="hidden-search fixed top-20 left-1/2 transform -translate-x-1/2 z-40 w-full max-w-xl px-6">
    <form id="searchForm">
      <input type="text" id="searchInput" placeholder="Search Nuerax.xyz"
        class="w-full bg-[#1A1D21] text-white placeholder-[#A1A6AD] px-5 py-4 rounded-xl border border-[#00FFFF]/20 focus:outline-none focus:ring-2 focus:ring-cyan-400 shadow-xl">
    </form>
  </div>

  <!-- News Feed -->
  <section id="feed" class="relative z-10 w-full max-w-5xl mx-auto px-4 fade-in mt-40">
    <div id="news-container">
      <p class="text-[#A1A6AD]">Loading news...</p>
    </div>
  </section>

  <!-- Particle Script -->
  <script>
    tsParticles.load("tsparticles", {
      fullScreen: { enable: false },
      background: { color: "#0F1115" },
      particles: {
        number: { value: 50, density: { enable: true, value_area: 800 } },
        color: { value: "#00FFFF" },
        shape: { type: "circle" },
        opacity: { value: 0.3 },
        size: { value: 2 },
        links: {
          enable: true,
          distance: 130,
          color: "#00FFFF",
          opacity: 0.2,
          width: 1
        },
        move: {
          enable: true,
          speed: 0.5,
          direction: "none",
          outModes: { default: "bounce" }
        }
      },
      interactivity: {
        events: {
          onHover: { enable: true, mode: "grab" },
          resize: true
        },
        modes: {
          grab: {
            distance: 140,
            links: { opacity: 0.3 }
          }
        }
      },
      detectRetina: true
    });
  </script>

  <!-- UI Behavior -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      document.body.classList.add("fade-in");
    });

    document.querySelectorAll("a.transition-link").forEach(link => {
      link.addEventListener("click", function (e) {
        e.preventDefault();
        const href = this.getAttribute("href");
        document.body.classList.remove("fade-in");
        document.body.style.opacity = 0;
        setTimeout(() => window.location.href = href, 300);
      });
    });

    let lastScrollY = window.scrollY;
    const navbar = document.getElementById("navbar");
    window.addEventListener("scroll", () => {
      if (window.scrollY > lastScrollY) {
        navbar.classList.add("opacity-60");
      } else {
        navbar.classList.remove("opacity-60");
      }
      lastScrollY = window.scrollY;
    });

    const searchToggle = document.getElementById("searchToggle");
    const searchDropdown = document.getElementById("searchDropdown");
    searchToggle.addEventListener("click", () => {
      searchDropdown.classList.toggle("hidden-search");
    });

    const searchForm = document.getElementById("searchForm");
    const searchInput = document.getElementById("searchInput");
    searchForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const query = searchInput.value.trim();
      if (query) {
        window.location.href = `explore.html?company=${encodeURIComponent(query)}`;
      }
    });
  </script>

  <!-- News Fetch Logic -->
  <script>
    const newsContainer = document.getElementById('news-container');
    const urlParams = new URLSearchParams(window.location.search);
    const searchQuery = urlParams.get('company') || 'ai';

    const companyLogos = {
      openai: "https://upload.wikimedia.org/wikipedia/commons/0/04/OpenAI_Logo.svg",
      meta: "https://upload.wikimedia.org/wikipedia/commons/0/05/Meta_Platforms_Logo.svg",
      google: "https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg",
      nvidia: "https://upload.wikimedia.org/wikipedia/en/2/21/Nvidia_logo.svg",
      microsoft: "https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg",
      tesla: "https://upload.wikimedia.org/wikipedia/commons/b/bd/Tesla_Motors.svg",
      apple: "https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg",
      anthropic: "https://avatars.githubusercontent.com/u/110651149?s=200&v=4",
      palantir: "https://upload.wikimedia.org/wikipedia/commons/6/68/Palantir_Technologies_logo.svg"
    };

    function getLogo(name) {
      const key = name.toLowerCase();
      return companyLogos[key] || companyLogos["openai"];
    }

    function getHoursAgo(dateString) {
      const hours = Math.floor((Date.now() - new Date(dateString)) / (1000 * 60 * 60));
      return hours < 1 ? "Just now" : `${hours} hour${hours !== 1 ? "s" : ""} ago`;
    }

    function isAIArticle(article) {
      const keywords = ["ai", "artificial intelligence", "robot", "machine learning", "deep learning"];
      const content = `${article.title} ${article.description}`.toLowerCase();
      return keywords.some(k => content.includes(k));
    }

    async function fetchNews(query = "ai") {
      const res = await fetch(`/api/news?company=${encodeURIComponent(query)}`);
      const articles = await res.json();
      const filtered = articles.filter(isAIArticle);
      newsContainer.innerHTML = "";

      filtered.forEach(article => {
        const logoUrl = getLogo(query);
        const timeAgo = getHoursAgo(article.publishedAt);
        const card = document.createElement("div");
        card.className = "flex bg-[#1A1D21] rounded-xl overflow-hidden mb-6 shadow-lg hover:shadow-cyan-500/10 transition";

        card.innerHTML = `
          <div class="flex-shrink-0 bg-[#0F1115] p-4 flex items-center justify-center w-32 h-32">
            <img src="${logoUrl}" alt="logo" class="max-h-16 max-w-16 object-contain" />
          </div>
          <div class="p-5 flex flex-col justify-between">
            <div class="text-sm text-[#A1A6AD] mb-1">${timeAgo} • ${article.source.name}</div>
            <h3 class="text-lg font-semibold text-[#F5F7FA] mb-2">${article.title}</h3>
            <p class="text-[#A1A6AD] text-sm mb-3">${article.description || ''}</p>
            <a href="${article.url}" target="_blank" class="text-[#00FFFF] text-sm underline">Read full article →</a>
          </div>
        `;

        newsContainer.appendChild(card);
      });
    }

    fetchNews(searchQuery);
  </script>
</body>
</html>
