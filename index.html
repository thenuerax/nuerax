<!DOCTYPE html>
<html lang="en" class="bg-[#0F1115] text-[#F5F7FA] scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nuerax — Real-Time AI News</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.11.1/tsparticles.bundle.min.js"></script>
    <style>
      body {
        position: relative;
      }
      #tsparticles {
        position: fixed;
        z-index: 0;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
      }
      .fade-in {
        opacity: 0;
        transform: translateY(20px);
        animation: fadeIn 1s ease forwards;
      }
      @keyframes fadeIn {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>

  <body class="font-sans text-base antialiased bg-[#0F1115] relative">

    <div id="tsparticles"></div>

    <!-- Navbar -->
    <nav class="w-full flex justify-between items-center px-6 py-4 z-10 relative">
      <div class="text-xl font-semibold">Nuerax</div>
      <button id="loginBtn" class="text-[#00FFFF] border border-[#00FFFF] px-4 py-1 rounded hover:bg-[#00FFFF] hover:text-black transition">
        Log In
      </button>
    </nav>

    <!-- Hero -->
    <section class="flex flex-col items-center text-center mt-12 px-4 fade-in relative z-10">
      <h1 class="text-4xl md:text-5xl font-bold mb-4 tracking-tight bg-gradient-to-r from-[#00FFFF] to-white text-transparent bg-clip-text">
        The future is moving fast. <br />So are we.
      </h1>
      <p class="text-[#A1A6AD] max-w-xl mb-8">
        Real-time AI news, insights, and stock market impact — curated for the next generation.
      </p>
      <input type="text" id="searchInput" placeholder="Search by company..." class="px-6 py-3 w-full max-w-md rounded-xl bg-[#1A1D21] border border-[#2C2F33] text-white focus:outline-none focus:ring-2 focus:ring-[#00FFFF] mb-8">
    </section>

    <!-- News Feed -->
    <section id="feed" class="w-full max-w-5xl mx-auto px-4 fade-in relative z-10">
      <div id="news-container">
        <p class="text-[#A1A6AD]">Loading news...</p>
      </div>
    </section>

    <!-- Login Modal -->
    <div id="loginModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60">
      <div class="bg-[#1A1D21] p-6 rounded-xl w-full max-w-sm">
        <h2 class="text-lg font-semibold mb-4">Log in or Sign up</h2>
        <input id="emailInput" type="email" placeholder="Email" class="w-full mb-3 px-4 py-2 rounded bg-[#0F1115] text-white" />
        <input id="passwordInput" type="password" placeholder="Password" class="w-full mb-4 px-4 py-2 rounded bg-[#0F1115] text-white" />
        <button id="submitLogin" class="w-full bg-[#00FFFF] text-black font-medium px-4 py-2 rounded hover:opacity-90">Continue</button>
        <button id="closeModal" class="w-full mt-3 text-sm text-gray-400 hover:underline">Cancel</button>
      </div>
    </div>

    <!-- Supabase + Logic -->
    <script>
      const supabase = supabase.createClient(
        "https://qiiozzvsfpnhoxaamftf.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      );

      const loginBtn = document.getElementById("loginBtn");
      const loginModal = document.getElementById("loginModal");
      const closeModal = document.getElementById("closeModal");
      const submitLogin = document.getElementById("submitLogin");

      loginBtn.onclick = () => loginModal.classList.remove("hidden");
      closeModal.onclick = () => loginModal.classList.add("hidden");

      submitLogin.onclick = async () => {
        const email = document.getElementById("emailInput").value;
        const password = document.getElementById("passwordInput").value;

        const { data, error } = await supabase.auth.signInWithPassword({ email, password });

        if (error) {
          alert("Login failed. Trying to sign you up...");
          await supabase.auth.signUp({ email, password });
        } else {
          alert("Logged in!");
          loginModal.classList.add("hidden");
        }
      };

      // Check session
      supabase.auth.getSession().then(({ data: { session } }) => {
        if (session) {
          loginBtn.textContent = "Log out";
          loginBtn.onclick = async () => {
            await supabase.auth.signOut();
            location.reload();
          };
        }
      });
    </script>

    <!-- News Fetching -->
    <script>
      const newsContainer = document.getElementById("news-container");
      const searchInput = document.getElementById("searchInput");

      const companyLogos = {
        openai: "https://upload.wikimedia.org/wikipedia/commons/0/04/OpenAI_Logo.svg",
        meta: "https://upload.wikimedia.org/wikipedia/commons/0/05/Meta_Platforms_Logo.svg",
        google: "https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg",
        nvidia: "https://upload.wikimedia.org/wikipedia/en/2/21/Nvidia_logo.svg",
        microsoft: "https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg",
        tesla: "https://upload.wikimedia.org/wikipedia/commons/b/bd/Tesla_Motors.svg",
        apple: "https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg",
        anthropic: "https://avatars.githubusercontent.com/u/110651149?s=200&v=4",
        palantir: "https://upload.wikimedia.org/wikipedia/commons/6/68/Palantir_Technologies_logo.svg",
      };

      function getLogo(name) {
        const key = name.toLowerCase();
        return companyLogos[key] || companyLogos["openai"];
      }

      function getHoursAgo(dateString) {
        const hours = Math.floor((Date.now() - new Date(dateString)) / (1000 * 60 * 60));
        return hours < 1 ? "Just now" : `${hours} hour${hours !== 1 ? "s" : ""} ago`;
      }

      async function fetchNews(query = "ai") {
        const res = await fetch(`/api/news?company=${encodeURIComponent(query)}`);
        const articles = await res.json();

        const filtered = articles.filter(a => {
          const text = (a.title + a.description).toLowerCase();
          return text.includes("ai") || text.includes("robot") || text.includes("artificial intelligence");
        });

        newsContainer.innerHTML = "";

        filtered.forEach((article) => {
          const card = document.createElement("div");
          card.className = "flex bg-[#1A1D21] rounded-xl overflow-hidden mb-6 shadow-lg hover:shadow-cyan-500/10 transition";

          card.innerHTML = `
            <div class="flex-shrink-0 bg-[#0F1115] p-4 flex items-center justify-center w-32 h-32">
              <img src="${getLogo(article.title)}" class="max-h-16 max-w-16 object-contain" />
            </div>
            <div class="p-5 flex flex-col justify-between">
              <div class="text-sm text-[#A1A6AD] mb-1">${getHoursAgo(article.publishedAt)} • ${article.source.name}</div>
              <h3 class="text-lg font-semibold text-[#F5F7FA] mb-2">${article.title}</h3>
              <p class="text-[#A1A6AD] text-sm mb-3">${article.description || ""}</p>
              <a href="${article.url}" target="_blank" class="text-[#00FFFF] text-sm underline">Read full article →</a>
            </div>
          `;

          newsContainer.appendChild(card);
        });
      }

      searchInput.addEventListener("input", (e) => {
        fetchNews(e.target.value.trim() || "ai");
      });

      fetchNews();
    </script>

    <!-- Background Animation -->
    <script>
      tsParticles.load("tsparticles", {
        fullScreen: { enable: false },
        background: { color: "#0F1115" },
        particles: {
          number: { value: 60 },
          color: { value: "#00ffff" },
          shape: { type: "circle" },
          opacity: { value: 0.2 },
          size: { value: 2 },
          move: { enable: true, speed: 0.3, direction: "none", out_mode: "bounce" },
        },
      });
    </script>
  </body>
</html>
